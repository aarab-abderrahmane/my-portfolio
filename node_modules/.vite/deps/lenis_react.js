"use client";
import {
  Lenis
} from "./chunk-TDBVHVHE.js";
import {
  require_jsx_runtime
} from "./chunk-UKFIC3ES.js";
import {
  require_react
} from "./chunk-LDGIP5W7.js";
import {
  __publicField,
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/lenis/dist/lenis-react.mjs
var import_react = __toESM(require_react(), 1);
var import_react2 = __toESM(require_react(), 1);
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_react3 = __toESM(require_react(), 1);
var Store = class {
  constructor(state) {
    __publicField(this, "listeners", []);
    this.state = state;
  }
  set(state) {
    this.state = state;
    for (let listener of this.listeners) {
      listener(this.state);
    }
  }
  subscribe(listener) {
    this.listeners = [...this.listeners, listener];
    return () => {
      this.listeners = this.listeners.filter((l) => l !== listener);
    };
  }
  get() {
    return this.state;
  }
};
function useStore(store) {
  const [state, setState] = (0, import_react2.useState)(store.get());
  (0, import_react2.useEffect)(() => {
    return store.subscribe((state2) => setState(state2));
  }, [store]);
  return state;
}
var LenisContext = (0, import_react.createContext)(null);
var rootLenisContextStore = new Store(null);
var ReactLenis = (0, import_react.forwardRef)(
  ({
    children,
    root = false,
    options = {},
    autoRaf = true,
    ...props
  }, ref) => {
    const wrapperRef = (0, import_react.useRef)(null);
    const contentRef = (0, import_react.useRef)(null);
    const [lenis, setLenis] = (0, import_react.useState)(void 0);
    (0, import_react.useImperativeHandle)(
      ref,
      () => ({
        wrapper: wrapperRef.current,
        content: contentRef.current,
        lenis
      }),
      [lenis]
    );
    (0, import_react.useEffect)(() => {
      const lenis2 = new Lenis({
        ...options,
        ...wrapperRef.current && contentRef.current && {
          wrapper: wrapperRef.current,
          content: contentRef.current
        },
        autoRaf: (options == null ? void 0 : options.autoRaf) ?? autoRaf
        // this is to avoid breaking the autoRaf prop if it's still used (require breaking change)
      });
      setLenis(lenis2);
      return () => {
        lenis2.destroy();
        setLenis(void 0);
      };
    }, [root, JSON.stringify({ ...options, wrapper: null, content: null })]);
    const callbacksRefs = (0, import_react.useRef)([]);
    const addCallback = (0, import_react.useCallback)(
      (callback, priority) => {
        callbacksRefs.current.push({ callback, priority });
        callbacksRefs.current.sort((a, b) => a.priority - b.priority);
      },
      []
    );
    const removeCallback = (0, import_react.useCallback)(
      (callback) => {
        callbacksRefs.current = callbacksRefs.current.filter(
          (cb) => cb.callback !== callback
        );
      },
      []
    );
    (0, import_react.useEffect)(() => {
      if (root && lenis) {
        rootLenisContextStore.set({ lenis, addCallback, removeCallback });
        return () => rootLenisContextStore.set(null);
      }
    }, [root, lenis, addCallback, removeCallback]);
    (0, import_react.useEffect)(() => {
      if (!lenis) return;
      const onScroll = (data) => {
        var _a;
        for (let i = 0; i < callbacksRefs.current.length; i++) {
          (_a = callbacksRefs.current[i]) == null ? void 0 : _a.callback(data);
        }
      };
      lenis.on("scroll", onScroll);
      return () => {
        lenis.off("scroll", onScroll);
      };
    }, [lenis]);
    if (!children) return null;
    return (0, import_jsx_runtime.jsx)(
      LenisContext.Provider,
      {
        value: { lenis, addCallback, removeCallback },
        children: root && root !== "asChild" ? children : (0, import_jsx_runtime.jsx)("div", { ref: wrapperRef, ...props, children: (0, import_jsx_runtime.jsx)("div", { ref: contentRef, children }) })
      }
    );
  }
);
var fallbackContext = {};
function useLenis(callback, deps = [], priority = 0) {
  const localContext = (0, import_react3.useContext)(LenisContext);
  const rootContext = useStore(rootLenisContextStore);
  const currentContext = localContext ?? rootContext ?? fallbackContext;
  const { lenis, addCallback, removeCallback } = currentContext;
  (0, import_react3.useEffect)(() => {
    if (!callback || !addCallback || !removeCallback || !lenis) return;
    addCallback(callback, priority);
    callback(lenis);
    return () => {
      removeCallback(callback);
    };
  }, [lenis, addCallback, removeCallback, priority, ...deps]);
  return lenis;
}
export {
  ReactLenis as Lenis,
  LenisContext,
  ReactLenis,
  ReactLenis as default,
  useLenis
};
//# sourceMappingURL=lenis_react.js.map
